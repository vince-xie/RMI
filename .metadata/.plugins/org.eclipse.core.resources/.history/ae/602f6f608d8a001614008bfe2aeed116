package remote;

import java.rmi.RemoteException;
import java.rmi.server.UnicastRemoteObject;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Comparator;
import java.util.List;

import static utils.DistanceCalculator.calculateDistance;

import AirportData.AirportDataProto.Airport;
import AirportData.AirportDataProto.AirportList;

/**
 * @author Vincent Xie, Edmond Wu
 */
public class Airports extends UnicastRemoteObject implements AirportsInterface {

	private static final long serialVersionUID = 1L;
	private AirportList airportList;

	public Airports(AirportList airportList) throws RemoteException {
		this.airportList = airportList;
	}

	/**
	 * Gets a list of the nearest airports to the specified longitude and latitude.
	 * @param latitude
	 * @param longitude
	 * @return List of nearest airports
	 */
	public List<Airport> getNearestAirports(double latitude, double longitude) {
		List<Airport> nearestAirports = new ArrayList<Airport>();
		int highestIndex = 0;
		double highestDistance = -1;
		for (Airport a: airportList.getAirportList()) {
			double distance = calculateDistance(latitude, longitude, a);
            if (nearestAirports.size() < 5) {
            	nearestAirports.add(a);
            	if (distance > highestDistance) {
            		highestIndex = nearestAirports.size() - 1;
            		highestDistance = distance;
            	}
            } else {
            	if (distance < highestDistance) {
            		nearestAirports.set(highestIndex, a);
            		highestIndex = 0;
                	highestDistance = -1;
                	for (int i = 0; i < nearestAirports.size(); i++) {
                		double d = calculateDistance(latitude, longitude, nearestAirports.get(i));
                		if (d > highestDistance) {
                			highestIndex = i;
                			highestDistance = d;
                		}
                	}
            	} 
            }
		}
		nearestAirports.sort((a, b) -> {
			if (calculateDistance(latitude, longitude, a) < calculateDistance(latitude, longitude, b)) {
				return -1;
			} else {
				return 0;
			}
		});
		return nearestAirports;
	}
}
